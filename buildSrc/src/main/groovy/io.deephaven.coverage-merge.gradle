plugins {
    id 'base'
    id 'jacoco-report-aggregation'
}

jacoco {
    toolVersion = '0.8.12'
}

tasks.register("coverage-merge", JacocoReport) {
    def jprojects = allprojects.findAll { p-> p.plugins.hasPlugin('java') }
    additionalSourceDirs = files(jprojects.sourceSets.main.allSource.srcDirs)
    sourceDirectories = files(jprojects.sourceSets.main.allSource.srcDirs)
    classDirectories = files(jprojects.sourceSets.main.output)
    reports {
        html.required = true
        csv.required = true
        xml.required = false
    }
    def projRootDir = project.rootDir.absolutePath
    executionData fileTree(projRootDir).include("**/build/jacoco/*.exec")
}
