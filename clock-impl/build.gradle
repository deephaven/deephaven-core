plugins {
    id 'io.deephaven.project.register'
}

description 'Implementation for the Clock service to obtain allocation-free precise time.'

dependencies {
    implementation project(':clock')
    compileOnly libs.autoservice
    annotationProcessor libs.autoservice.compiler
}

tasks.withType(JavaCompile).configureEach {
    options.compilerArgs += ['--add-exports', 'java.base/jdk.internal.misc=ALL-UNNAMED']
    // Explicitly unset release so gradle will invoke javac with `-source <languageLevel> -target <languageLevel>`
    // instead of `--release <languageLevel>`, which would otherwise produce
    // > error: exporting a package from system module java.base is not allowed with --release
    options.release.unset()
}

tasks.withType(Javadoc).configureEach {
    options.addStringOption('-add-exports', 'java.base/jdk.internal.misc=ALL-UNNAMED')
}
