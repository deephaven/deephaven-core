/*
 * Copyright (c) 2016-2025 Deephaven Data Labs and Patent Pending
 */
syntax = "proto3";

package io.deephaven.proto.backplane.grpc;

option java_multiple_files = true;
option optimize_for = SPEED;
option go_package = "github.com/deephaven/deephaven-core/go/internal/proto/remotefilesource";

import "deephaven_core/proto/ticket.proto";

// Server → Client: Requests sent from server to client via MessageStream
message RemoteFileSourceServerRequest {
  // Unique identifier for this request, used to correlate the response
  string request_id = 1;

  oneof request {
    // Request source data/resource from the client
    RemoteFileSourceMetaRequest meta_request = 2;

    // Acknowledgment that execution context was set
    SetExecutionContextResponse set_execution_context_response = 3;
  }
}

// Client → Server: Requests/responses sent from client to server via MessageStream
message RemoteFileSourceClientRequest {
  // The request_id from the ServerRequest this is responding to (if applicable)
  string request_id = 1;

  oneof request {
    // Response to a resource request
    RemoteFileSourceMetaResponse meta_response = 2;

    // Set the execution context for script execution
    SetExecutionContextRequest set_execution_context = 3;
  }
}

// Request source data/resource from the client
message RemoteFileSourceMetaRequest {
  // The name/path of the resource being requested (e.g., "com/example/MyClass.java")
  string resource_name = 1;
}

// Response to a resource request
message RemoteFileSourceMetaResponse {
  // The content of the resource, or empty if not found
  bytes content = 1;

  // Indicates whether the resource was found
  bool found = 2;

  // Error message if the resource could not be retrieved
  string error = 3;
}

// Request to set the execution context for script execution
message SetExecutionContextRequest {
  // Resource paths that should be resolved from the remote source
  // (e.g., ["com/example/Test.groovy", "org/mycompany/Utils.groovy"])
  repeated string resource_paths = 1;
}

// Response acknowledging execution context was set
message SetExecutionContextResponse {
  // Whether the operation was successful
  bool success = 1;
}

// Fetch the remote file source plugin into the specified ticket (Flight command, not MessageStream)
message RemoteFileSourcePluginFetchRequest {
  io.deephaven.proto.backplane.grpc.Ticket result_id = 1;

  // The plugin name to create the PluginMarker for.
  string plugin_name = 2;
}