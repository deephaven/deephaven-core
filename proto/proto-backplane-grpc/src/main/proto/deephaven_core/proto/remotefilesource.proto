/*
 * Copyright (c) 2016-2022 Deephaven Data Labs and Patent Pending
 */
syntax = "proto3";

package io.deephaven.proto.backplane.grpc;

option java_multiple_files = true;
option optimize_for = SPEED;
option go_package = "github.com/deephaven/deephaven-core/go/internal/proto/remotefilesource";

import "deephaven_core/proto/ticket.proto";

// Server → Client: Requests sent from server to client via MessageStream
message RemoteFileSourceServerRequest {
  // Unique identifier for this request, used to correlate the response
  string request_id = 1;

  oneof request {
    // Request source data/resource from the client
    RemoteFileSourceMetaRequest meta_request = 2;

    // Acknowledgment that connection ID was set
    RemoteFileSourceSetConnectionIdResponse set_connection_id_response = 3;
  }
}

// Client → Server: Requests/responses sent from client to server via MessageStream
message RemoteFileSourceClientRequest {
  // The request_id from the ServerRequest this is responding to (if applicable)
  string request_id = 1;

  oneof request {
    // Response to a resource request
    RemoteFileSourceMetaResponse meta_response = 2;

    // Future: other client-initiated messages
    RemoteFileSourceSetConnectionIdRequest set_connection_id = 3;

    // Test command (e.g., "TEST:com/example/Test.java") - client triggers server to request a resource back
    string test_command = 4;
  }
}

// Request source data/resource from the client
message RemoteFileSourceMetaRequest {
  // The name/path of the resource being requested (e.g., "com/example/MyClass.java")
  string resource_name = 1;
}

// Response to a resource request
message RemoteFileSourceMetaResponse {
  // The content of the resource, or empty if not found
  bytes content = 1;

  // Indicates whether the resource was found
  bool found = 2;

  // Optional: error message if the resource could not be retrieved
  string error = 3;
}

message RemoteFileSourceSetConnectionIdRequest {
  // The connection ID to set for the remote file source.
  string connection_id = 1;
}

// Acknowledgment response for setting connection ID
message RemoteFileSourceSetConnectionIdResponse {
  // The connection ID that was set
  string connection_id = 1;

  // Whether the operation was successful
  bool success = 2;
}

// Fetch the remote file source plugin into the specified ticket (Flight command, not MessageStream)
message RemoteFileSourcePluginFetchRequest {
  io.deephaven.proto.backplane.grpc.Ticket result_id = 1;
}