<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Deephaven Web API Password authentication</title>
    <script src="../dh-internal.js" type="text/javascript"></script>
    <script src="../dh-core.js" type="text/javascript"></script>
</head>
<body>
<p>
    Deephaven uses Flight's v2 Basic authentication mechanism to support username+password credentials. This is a simple
    and familiar way for a user to prove their identity. Deephaven's <code>io.deephaven.auth.BasicAuthMarshaller.Handler</code>
    interface allows deployers to offer their own way to tie those credentials to some user store.
</p>
<p>
    A sample implementation is provided, backed by a postgres instance that can easily be run in docker. This only has
    one account added to it, with username "admin" and password "p@ssw0rd". For convinience sake, these credentials are
    auto-populated below.
</p>
<label for="username">Username:</label><input id="username" type="text" value="admin" />
<br />
<label for="password">Username:</label><input id="password" type="password" value="p@ssw0rd" />
<br />
<button id="go">Go</button>
<div id="log"></div>
<script type="application/javascript">
    function log(msg) {
        document.getElementById('log').append(msg, document.createElement('br'));
    }

    document.getElementById('go').onclick = e => {
        var client = new dh.CoreClient(window.location.protocol + "//" + window.location.host);
        // Check that we have some basic auth handler
        //TODO

        // pass the username and password to login
        var username = document.getElementById('username').value;
        var token = document.getElementById('password').value;
        client.login({
            type: dh.CoreClient.LOGIN_TYPE_PASSWORD,
            username,
            token
        }).then(
            success => log("Success!"),
            failure => log(failure)
        );
    }
</script>
</body>
</html>
