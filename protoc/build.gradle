plugins {
    id 'com.bmuschko.docker-remote-api'
}

evaluationDependsOn Docker.registryProject('node')

def prepareDocker = project.tasks.register('prepareDocker', Sync) {
    from(project.projectDir) {
        exclude 'build'
        exclude 'build.gradle'
    }
    into 'build/docker'
}

def buildDocker = Docker.registerDockerImage(project, 'buildDocker') {
    inputs.files prepareDocker.get().outputs.files
    inputs.files Docker.registryFiles(project, 'node')
    images.add('deephaven/protoc:local-build')
}

assemble.dependsOn buildDocker