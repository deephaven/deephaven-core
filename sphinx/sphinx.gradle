
plugins {
    id 'com.bmuschko.docker-remote-api'
}

evaluationDependsOn ':Integrations'

boolean java8 = JavaVersion.current().isJava8()
List<Object> dependsList
dependsList = [':Generators:generateFigureImmutable',
                          ':Generators:generatePythonFigureWrapper',
                          ':Generators:generatePythonIntegrationStaticMethods',
]
def sourceDir = "$projectDir/source"
def docBuildDir = "$buildDir/docs"

TaskProvider<? extends Task> pyDoc

pyDoc = Docker.registerDockerTask(project, "pythonDocs") {
    copyIn {
        from 'docker'
        from(sourceDir) {
            into 'source'
        }
    }
//        dockerfile = project.file('Dockerfile') // not needed with the above from 'docker'
    parentContainers = [project(':Integrations').tasks.findByName('buildDeephavenPython')] // deephaven/runtime-base
    imageName = 'deephaven/sphinx:local-build'
    containerOutPath = '/build'
    copyOut {
        into docBuildDir
    }
}

pyDoc.configure {
    dependsOn dependsList
}

project.tasks.register 'pythonDocsTar', Tar, {
    Tar tar ->
        tar.from(docBuildDir)
        tar.dependsOn(pyDoc)
        tar.archiveBaseName.set("dh-python-docs")
}
